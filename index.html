<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Breathing Animation</title>
  <style>
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      font-family: Arial, sans-serif;
    }

    #circle {
      width: 170px;
      height: 170px;
      border-radius: 50%;
      background: rgba(0, 0, 255, 0.5);
      margin-bottom: 40px;
      position: relative;
    }

    .inner-circle {
      width: 80%;
      height: 80%;
      border-radius: 50%;
      background: rgba(0, 0, 255, 0.5);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      box-shadow: 0px 0px 8px 0px rgba(0, 0, 0, 0.2);
    }

    #inner-circle-2 {
      width: 60%;
      height: 60%;
    }

    #inner-circle-3 {
      width: 40%;
      height: 40%;
    }

    #speedControl,
    #inhaleDelayControl,
    #exhaleDelayControl {
      margin-top: 20px;
      width: 50%;
    }
  </style>
</head>

<body>
  <div id="container">
    <div id="circle">
      <div class="inner-circle" id="inner-circle"></div>
      <div class="inner-circle" id="inner-circle-2"></div>
      <div class="inner-circle" id="inner-circle-3"></div>
    </div>
    <label for="speedControl">Adjust Breathing Speed:</label>
    <input type="range" id="speedControl" min="1" max="3" step="1" value="1">
    <label for="inhaleDelayControl">Adjust Inhale Pause Duration:</label>
    <input type="range" id="inhaleDelayControl" min="0" max="2" step="0.1" value="0.5">
    <label for="exhaleDelayControl">Adjust Exhale Pause Duration:</label>
    <input type="range" id="exhaleDelayControl" min="0" max="2" step="0.1" value="0.5">
  </div>

  <script>
    const circle = document.getElementById('circle');
    const innerCircle = document.getElementById('inner-circle');
    const innerCircle2 = document.getElementById('inner-circle-2');
    const innerCircle3 = document.getElementById('inner-circle-3');
    const speedControl = document.getElementById('speedControl');
    const inhaleDelayControl = document.getElementById('inhaleDelayControl');
    const exhaleDelayControl = document.getElementById('exhaleDelayControl');

    let speed = 1; // Initial speed value
    let inhaleDelay = 0.5; // Initial inhale delay value
    let exhaleDelay = 0.5; // Initial exhale delay value
    let scale = 1;
    let innerScale = 1;
    let innerScale2 = 1;
    let innerScale3 = 1;
    let growing = true;
    let pause = false;

    const inhaleSound = new Audio("inhale.mp3"); // Replace with your inhale sound file
    const exhaleSound = new Audio("exhale.mp3"); // Replace with your exhale sound file

    function animateBreathing() {
      const baseStep = 0.01 * speed; // Adjust scale change based on speed
      const step = baseStep * Math.max(0.2, growing ? (1 - (scale - 1) / 0.5) : (1 - (1.5 - scale) / 0.5));
      const innerStep = step * 0.5; // Inner circle lags further behind

      if (!pause) {
        if (growing) {
          scale += step;
          innerScale += Math.min(innerStep, 1.5 - innerScale); // Ensure innerScale does not exceed outer scale
          innerScale2 += Math.min(innerStep, 1.5 - innerScale2); // Ensure innerScale does not exceed outer scale
          innerScale3 += Math.min(innerStep, 1.5 - innerScale3); // Ensure innerScale does not exceed outer scale
          if (scale >= 1.5) {
            growing = false;
            pause = true;
            setTimeout(() => {
              pause = false
              inhaleSound.pause();
              exhaleSound.currentTime = 0;
              exhaleSound.play().catch(err => console.error("Exhale sound issue:", err));
            }, exhaleDelay * 1000);
          }
        } else {
          scale -= step;
          innerScale -= Math.min(innerStep, innerScale - 1); // Ensure innerScale does not fall below 1
          innerScale2 -= Math.min(innerStep, innerScale2 - 1); // Ensure innerScale does not fall below 1
          innerScale3 -= Math.min(innerStep, innerScale3 - 1); // Ensure innerScale does not fall below 1
          if (scale <= 1) {
            growing = true;
            pause = true;
            setTimeout(() => {
              pause = false
              exhaleSound.pause();
              inhaleSound.currentTime = 0;
              inhaleSound.play().catch(err => console.error("Inhale sound issue:", err));
            }, inhaleDelay * 1000);
          }
        }

        circle.style.transform = `scale(${scale})`;
        innerCircle.style.transform = `translate(-50%, -50%) scale(${innerScale})`;
        innerCircle2.style.transform = `translate(-50%, -50%) scale(${innerScale2})`;
        innerCircle3.style.transform = `translate(-50%, -50%) scale(${innerScale3})`;
      }

      requestAnimationFrame(animateBreathing);
    }

    speedControl.addEventListener('input', (e) => {
      speed = parseFloat(e.target.value);
    });

    inhaleDelayControl.addEventListener('input', (e) => {
      inhaleDelay = parseFloat(e.target.value);
    });

    exhaleDelayControl.addEventListener('input', (e) => {
      exhaleDelay = parseFloat(e.target.value);
    });

    // Start the animation
    animateBreathing();
  </script>
</body>

</html>
